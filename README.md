## Employee Manager API

Simple employee management API built with **Laravel 12**, featuring **Sanctum** authentication, employee CRUD, attendance tracking with queued email notifications, and daily attendance reports in **PDF** and **Excel** formats.

### Stack

- **Backend**: Laravel 12 (PHP 8.2+)
- **Auth**: Laravel Sanctum (stateless API tokens)
- **Queues**: Database queue
- **Mail**: Mailpit
- **PDF**: `barryvdh/laravel-snappy`
- **Excel**: `maatwebsite/excel`
- **Container tooling**: Laravel Sail
- **Docs**: OpenAPI v3 (PHP 8 attributes, `zircote/swagger-php`)

### Local setup (without Sail)

- **Clone & install**
  - `composer install`
  - Copy `.env.example` to `.env`
  - `php artisan key:generate`
- **Database**
  - By default the app uses **SQLite** (see `DB_CONNECTION=sqlite` in `.env.example`).
  - For SQLite, no extra configuration is needed; migrations will create tables automatically.
- **Migrations & seeders**
  - `php artisan migrate`
- **Queue worker**
  - For queued emails in local dev, run:
    - `php artisan queue:work`
- **Serve the API**
  - `php artisan serve` (defaults to `http://127.0.0.1:8000`)

### Local setup with Laravel Sail (Docker)

1. **Install Sail dependencies**
   - Ensure Docker is running.
   - `composer install`
2. **Install Sail (if not yet installed)**
   - `php artisan sail:install` and choose MySQL & Redis if prompted.
3. **Update `.env` for Sail**
   - Switch database to MySQL (see commented section in `.env.example`):
     - `DB_CONNECTION=mysql`
     - `DB_HOST=mysql`
     - `DB_PORT=3306`
     - `DB_DATABASE=employee_manager`
     - `DB_USERNAME=sail`
     - `DB_PASSWORD=password`
   - Ensure Mailpit settings:
     - `MAIL_MAILER=smtp`
     - `MAIL_HOST=mailpit`
     - `MAIL_PORT=1025`
4. **Start containers**
   - `./vendor/bin/sail up -d`
5. **Run migrations & queue worker**
   - `./vendor/bin/sail artisan migrate`
   - `./vendor/bin/sail artisan queue:work`
6. **Access services**
   - API: `http://localhost`
   - Mailpit UI: `http://localhost:8025`

### Mailpit

- Mailpit is configured via `.env.example` to use:
  - `MAIL_MAILER=smtp`
  - `MAIL_HOST=mailpit`
  - `MAIL_PORT=1025`
- With Sail, Mailpit is available on `http://localhost:8025`. All queued attendance emails will appear there.

### Authentication (Sanctum)

- **Register**: `POST /api/auth/register`
- **Login**: `POST /api/auth/login`
- **Logout**: `POST /api/auth/logout` (requires `Authorization: Bearer {token}`)
- **Forgot password**: `POST /api/auth/forgot-password`
- **Reset password**: `POST /api/auth/reset-password`

All protected endpoints require a **Bearer token** obtained from the login or register endpoint:

- `Authorization: Bearer {token}`

### Employee management

All employee routes are protected by `auth:sanctum`:

- `GET /api/employees` — list employees (paginated).
- `POST /api/employees` — create employee.
- `GET /api/employees/{id}` — show employee.
- `PUT /api/employees/{id}` — update employee.
- `DELETE /api/employees/{id}` — delete employee.

Required fields when creating:

- `names` (string)
- `email` (unique)
- `employee_identifier` (unique)
- `phone_number` (optional)

### Attendance management

All attendance routes are protected by `auth:sanctum`:

- `GET /api/attendance?date=YYYY-MM-DD` — list attendance records (optional date filter).
- `POST /api/attendance/check-in`
  - Body: `{ "employee_id": 1 }`
  - Records a **check-in** at current time and queues an email to the employee.
- `POST /api/attendance/check-out`
  - Body: `{ "employee_id": 1 }`
  - Sets `check_out_at` on the latest open attendance record and queues an email.

### Attendance reports

All report routes are protected by `auth:sanctum` and accept an optional `date` query param (defaults to today):

- **PDF daily report**
  - `GET /api/reports/attendance/daily/pdf?date=YYYY-MM-DD`
  - Returns a PDF file generated via `laravel-snappy` based on the `resources/views/reports/daily_attendance.blade.php` template.
- **Excel daily report**
  - `GET /api/reports/attendance/daily/excel?date=YYYY-MM-DD`
  - Returns an `.xlsx` export generated by `maatwebsite/excel`.

### OpenAPI documentation

- The API spec is generated using **PHP 8 attributes** (`OpenApi\Attributes` from `zircote/swagger-php`).
- Fetch the OpenAPI v3 JSON:
  - `GET /api/openapi.json`
- You can point tools like Swagger UI or Postman to this endpoint to explore the API.

### Running tests

- The project ships with PHPUnit configuration using an in-memory SQLite database.
- To run the test suite:
  - `php artisan test`
  - Or with Sail: `./vendor/bin/sail artisan test`
